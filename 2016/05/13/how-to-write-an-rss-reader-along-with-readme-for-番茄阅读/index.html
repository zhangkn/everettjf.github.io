<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>How to write an RSS reader, along with readme for 番茄阅读</title>
	
	<meta name="description" content="">
	<meta name="image" content="favicon.ico">
	
	<meta itemprop="name" content="How to write an RSS reader, along with readme for 番茄阅读">
	<meta itemprop="description" content="">
	<meta itemprop="image" content="favicon.ico">
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:title" content="How to write an RSS reader, along with readme for 番茄阅读">
	<meta name="twitter:description" content="">
	<meta name="twitter:site" content="@everettjf">
	<meta name="twitter:creator" content="@everettjf">
	<meta name="twitter:image:src" content="favicon.ico">
	
	
	<meta name="og:title" content="How to write an RSS reader, along with readme for 番茄阅读">
	<meta name="og:description" content="">
	<meta name="og:image" content="http://everettjf.com/favicon.ico">
	<meta name="og:url" content="http://everettjf.com/2016/05/13/how-to-write-an-rss-reader-along-with-readme-for-%E7%95%AA%E8%8C%84%E9%98%85%E8%AF%BB/">
	<meta name="og:site_name" content="How to write an RSS reader, along with readme for 番茄阅读">
	<meta name="og:type" content="article">
	
	<meta name="article:author" content="everettjf">
	<meta name="article:tag" content="">
	<link rel="stylesheet" type="text/css" href="/css/style.css">
	<script src="/js/caption.js"></script>

	<link rel="icon" href="/favicon.ico" type="image/x-icon">  
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">  

	
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111349332-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-111349332-1');
	</script>

</head>

<body>

<header>
	<a href="/">/posts</a>
	
		
		&nbsp;&nbsp;·&nbsp;<a href="/about/" style="color:black;">/about</a>
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	


</header>


<div class="content">
    <h1>How to write an RSS reader, along with readme for 番茄阅读 <aside></aside></h1>

    <p>
    <nav id="TableOfContents">
<ul>
<li><a href="#背景">背景</a></li>
<li><a href="#架构">架构</a>
<ul>
<li><a href="#web服务器">Web服务器</a></li>
<li><a href="#静态内容服务器">静态内容服务器</a></li>
<li><a href="#爬虫">爬虫</a></li>
<li><a href="#app">App</a>
<ul>
<li><a href="#开源库">开源库</a></li>
<li><a href="#加载策略">加载策略</a></li>
<li><a href="#订阅文章内容显示">订阅文章内容显示</a></li>
<li><a href="#加载动画">加载动画</a></li>
<li><a href="#第三方服务">第三方服务</a></li>
</ul></li>
</ul></li>
<li><a href="#总结">总结</a></li>
</ul>
</nav>
    </p>

    <hr/>
    <p>&nbsp;</p>

    

<p>终于上线第一个App，简单总结。对这个App，自己也算是“全栈开发”了。</p>

<p><a href="https://github.com/everettjf/TomatoRead">先上源码</a></p>

<p>此次开发过程主要有两个产出：</p>

<ol>
<li><a href="https://itunes.apple.com/us/app/id1111654149">番茄阅读App</a>：精选了一些iOS开发者博客的订阅。<a href="https://itunes.apple.com/us/app/id1111654149">AppStore地址</a>。</li>
<li><a href="https://github.com/everettjf/TomatoRead">博客列表</a>：按最后更新时间排序。每天自动刷新。</li>
</ol>

<p>三个Tab页，第一页为订阅的文章列表，第二页为博客列表，第三页为我平时收集的各种文章、教程等网址。
如下图：</p>

<p><img src="https://everettjf.github.io/stuff/tomato/1.png" alt="" /></p>

<h1 id="背景">背景</h1>

<ul>
<li>最初我是想做个大而全的开发者导航网站，想学什么都能找到最优质的网址，但没有那么多时间去搜集网址。由于工作是iOS开发，可以只关注iOS开发类的网址。</li>
<li>于是想做个App，将收集的博客以及博客的RSS订阅信息通过App展示出来。</li>
<li>目标不断的缩小，或许就是伪需求变为真实需求的过程。</li>
<li>更深入折腾的背景，可以看看<a href="http://everettjf.github.io/2016/02/24/iosblog-cc-dev-memory">这篇文章</a></li>
</ul>

<h1 id="架构">架构</h1>

<ul>
<li>Web服务器：用于收藏网址</li>
<li>静态内容服务器：用户提供App访问接口</li>
<li>爬虫：爬取不支持RSS/Atom订阅的博客文章列表</li>
<li>App：最终展现</li>
</ul>

<h2 id="web服务器">Web服务器</h2>

<p>Web服务器主要用于网址收集和删除。</p>

<p>为了能看到一个博客后，方便的收藏博客，可以编写<code>Chrome插件</code>。当浏览到一个博客网址后，点击Chrome插件，Chrome插件会自动收集当前博客的网址、标题、favicon。还可以添加订阅地址。</p>

<p>免去了使用文本方式记录博客的麻烦。</p>

<p>Web服务器使用Django实现（熟悉Python）。目前可以使用 <a href="http://iosblog.cc">http://iosblog.cc</a>访问，由于App并不依赖这个域名，后期可能、可以随时更换。这个网址仅用于辅助收集，不用于公开使用。</p>

<ul>
<li><a href="https://github.com/everettjf/TomatoRead/tree/master/chrome">Chrome插件源码</a></li>

<li><p><a href="https://github.com/everettjf/TomatoRead/tree/master/web">Web服务器源码</a></p></li>

<li><p><a href="https://docs.djangoproject.com/en/1.9/intro/">Django入门文档</a></p></li>

<li><p><a href="https://developer.chrome.com/extensions/getstarted">Chrome Extension 入门文档</a></p></li>
</ul>

<p><img src="https://everettjf.github.io/stuff/tomato/chrome.png" alt="" /></p>

<h2 id="静态内容服务器">静态内容服务器</h2>

<p>阿里云或其他各种云的VPS最低配置一般一年600元左右，而且带宽性能都较差。可又为了能让App较快的获取数据，怎么办。想到平时的博客使用GitHub Pages。可以把平时收藏到的内容，定时导出为json文件放到GitHub Pages下（例如我的博客目录下）。</p>

<p>而阿里云服务器就不用担心带宽太小、配置太低的问题了。亚马逊的EC2最近还免费一年。</p>

<p>这一层服务器的存在，让我们可以随便更换Web服务器。App也不依赖Web服务器。</p>

<p><a href="https://github.com/everettjf/everettjf.github.com/tree/master/app/blogreader">导出效果</a></p>

<h2 id="爬虫">爬虫</h2>

<p>有的博客是有RSS或Atom订阅的，但还有很多博客没有订阅。例如现在很火的<code>简书</code>。简书上有很多不错的 iOS/OS X 开发者博客。</p>

<p>收藏了一些不错的简书博客后，可以写个小爬虫，只爬指定博客的文章列表。App中点击这类文章时，直接以浏览器的方式打开。</p>

<p>scrapy是Python很好的爬虫框架，使用起来简单易用。爬某个网址文章列表的代码如下：</p>

<pre><code>    def parse(self, response):
        print response.url
        oid = self.url_to_oid[response.url]
        filepath = os.path.join(target_json_dir,'spider', 'jianshu', '%d.json'%oid)
        print filepath

        items = []
        for post in response.xpath('//div[@id=&quot;list-container&quot;]/ul/li'):
            url = post.xpath('div/h4[@class=&quot;title&quot;]/a/@href').extract_first()
            url = response.urljoin(url)

            title = post.xpath('div/h4[@class=&quot;title&quot;]/a/text()').extract_first()
            title = title.strip()

            item = {}
            item['title'] = title
            item['link'] = url
            item['createtime'] = post.xpath('div/p[@class=&quot;list-top&quot;]/span[@class=&quot;time&quot;]/@data-shared-at').extract_first()
            item['image'] = post.xpath('a[@class=&quot;wrap-img&quot;]/img/@src').extract_first()
            items.append(item)
</code></pre>

<p>Scrapy文档也很全，看完<a href="http://doc.scrapy.org/en/master/intro/tutorial.html">入门教程</a>就能完成这个简书文章列表的爬取了。</p>

<ul>
<li><a href="https://github.com/everettjf/TomatoRead/tree/master/jianspider">爬虫源码</a></li>
<li><a href="https://github.com/everettjf/everettjf.github.com/tree/master/app/blogreader/spider/jianshu">爬到的结果</a></li>
</ul>

<p>有个小问题，可以不解决。简书博客首页的文章默认是加载10条（数不一定对），剩余文章是在向下滚动浏览时异步加载。由于是做订阅，只抓取最新的N条就足够了。（如何抓取异步加载的这些文章，我还没有研究。或许找到请求后台的地址，就很容易抓取了）</p>

<h2 id="app">App</h2>

<h3 id="开源库">开源库</h3>

<p>为了快速组装这个App，主要用了以下两个开源库。</p>

<ul>
<li><p><a href="https://github.com/mwaterfall/MWFeedParser">MWFeedParser</a> 可用于解析RSS/Atom，但使用过程中有些源的时间并不标准，可以直接修改源码，增加支持的时间。</p></li>

<li><p><a href="https://github.com/dfmuir/KINWebBrowser">KINWebBrowser</a> 用于查看原文、或者打开不支持订阅的博客文章。</p></li>
</ul>

<h3 id="加载策略">加载策略</h3>

<p>当一下子拿到40多个订阅地址，如何能在让用户感觉不到太慢的前提下，把文章加载下来。</p>

<ul>
<li>服务器把更新比较频繁的、且优质的几个博客放在前面（排序靠前，增加zorder）</li>
<li>首次加载动画，在加载5个博客后，动画缩小到不影响用户使用的地方，继续加载剩余博客。</li>
<li>记录博客的最后文章更新日期，以后再次检测博客更新时，优先检查最近更新过的博客。（有一些开发者博客很久不更新文章了，但之前的文章写的很好。）尽量最快的显示出最新内容。</li>
<li>所有博客都加载完成后，可以让用户知道。并能方便的加载最新内容。</li>
</ul>

<p>其他可优化想法：</p>

<ul>
<li>每个博客一个权值，根据更新频率分配，在某些情况下可以直接忽略权值过低的博客。</li>
</ul>

<h3 id="订阅文章内容显示">订阅文章内容显示</h3>

<p>RSS/Atom订阅拿到的文章内容是一段html代码。缺少css。程序内部要内置一套较为通用的css。</p>

<p>这里目前直接copy了<a href="https://github.com/ming1016/RSSRead">已阅App</a>的css代码。但<a href="https://github.com/everettjf/TomatoRead/tree/master/iOS/iOSBlogReader/Resource">这个css</a>对有些文章展示的兼容不好。以后再优化啦。</p>

<h3 id="加载动画">加载动画</h3>

<p>类似MBProgressSUD的加载动画都是全局阻塞方式。不能满足 先加载5个博客后继续显示进度且不应影响用户使用的需求。于是自己造一个。</p>

<p>最近看最强大脑，在学习魔方算法，想来可以做个类似魔方的动画。为了简单、快速可用，可以用 facebook的 pop 库，9个颜色挨个淡入淡出，再加个状态栏。</p>

<p><img src="https://everettjf.github.io/stuff/tomato/loading.png" alt="" /></p>

<h3 id="第三方服务">第三方服务</h3>

<ul>
<li>统计：友盟</li>
<li>崩溃分析：bugly</li>
<li>热修复：JSPatch</li>
</ul>

<h1 id="总结">总结</h1>

<p>自己做iOS工作接近一年（中间暂停了3个月在家做奶爸了）,这是第一个上架的App。虽然App较为简单，但这个想法的演变过程，值得我反思和总结。</p>

<p>开发这个App还有个目的，就是可以把自己平时学到的新知识、新技巧应用到这个App中来，作为自己的小实验室。</p>


    
</div>



	<p><small><em>Written May 13, 2016. </em>
		 
		Send feedback to <a  href="https://twitter.com/intent/tweet?text=%40everettjf%20%2320160513how-to-write-an-rss-reader-along-with-readme-for-%25E7%2595%25AA%25E8%258C%2584%25E9%2598%2585%25E8%25AF%25BB%20">@everettjf</a>.
		
    </small></p>

	<p>
	<a href="/2016/05/10/symbolicatecrash-deadloop-bug/">← symbolicatecrash deadloop bug</a>&nbsp;
	<a href="/2016/05/25/ios-debug-cheatsheet/" style="float:right;">iOS Debug Cheatsheet →</a>
	</p>



<section id="disqus_thread"></section>


<script type="text/javascript">
     
    var disqus_shortname = 'everettjf';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

     
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



<footer>
	<hr/>
	<p>https://creativecommons.org/licenses/by-nc-sa/2.5/</p>
	<p>This site was made with <a href="https://github.com/gohugoio/hugo">Hugo</a> using theme <a href="https://github.com/schollz/onetwothree">onetwothree</a>.</p>
</footer>
</body>
</html>
